<ion-header>
    <ion-navbar>
        <ion-title><span>{{"Order Status" | translate}} - {{order.status}}</span></ion-title>
    </ion-navbar>
</ion-header>

<ion-content class="bg-color">
    <div *ngIf="showLoader" class="loader-bg">
        <ion-spinner class="spinner" color="light"></ion-spinner>
    </div> 
    <div class="job_status">
        <ion-row>
            <ion-col col-7>
                <div class="status d-flex active">
                    <h2>1</h2>
                    <div class="status_details">
                        <h3>{{"Awaiting Quotation" | translate}}</h3>
                        <p>{{order.created_at | date:'MMM d, y, h:mm a'}}</p>
                    </div>
                </div>
                <div class="status d-flex" *ngIf="order.status == 'Pending'">
                    <h2>2</h2>
                    <div class="status_details">
                        <h3>{{"Accept / Reject" | translate}}</h3>
                        <p>{{order.quotation_date != null ? (order.quotation_date | date:'MMM d, y, h:mm a') : '-'}}</p>
                    </div>
                </div>
                <div *ngIf="order.status != 'Pending'" class="status d-flex {{['','Quoted','Scheduled','Complete'].indexOf(order.status) ? 'active' : ''}}">
                    <h2>2</h2>
                    <div class="status_details">
                        <h3>{{"Quotation Received" | translate}}</h3>
                        <p>{{order.quotation_date != null ? (order.quotation_date | date:'MMM d, y, h:mm a') : '-'}}</p>
                    </div>
                </div>
                <div class="status d-flex {{order.status == 'Scheduled' || order.status == 'Complete'  ? 'active' : ''}}">
                    <h2>3</h2>
                    <div class="status_details">
                        <h3>{{"Scheduled" | translate}}</h3>
                        <p>{{order.service_schedule != null ? (order.service_schedule | date:'MMM d, y, h:mm a') : '-'}}</p>
                    </div>
                </div>
                <div class="status d-flex {{'Complete' == order.status ? 'active' : ''}}">
                    <h2>4</h2>
                    <div class="status_details">
                        <h3>{{'Finished' | translate}}</h3>
                        <p>{{'Complete' == order.status ? (order.service_schedule | date:'MMM d, y, h:mm a') : '-'}}</p>
                    </div>
                </div>
            </ion-col>
            <ion-col col-5>
                <div class="img_box center_img">
                    <img src="{{status_img}}" class="crop_img">
                </div>
                <div class="d-flex" style="flex-direction: column;">

                    <button *ngIf="order.status == 'Quoted'" (click)="approve()" ion-button block icon-start class="btn">
                        <ion-icon name="checkmark"></ion-icon> {{"Accept" | translate}}
                    </button>
                    <button *ngIf="order.status == 'Quoted'" (click)="reject()" ion-button block icon-start class="btn danger">
                        <ion-icon name="close"></ion-icon> {{"Reject" | translate}}
                    </button>

                    <button *ngIf="order.status == 'Pending'" (click)="cancelOrder()" ion-button block class="btn">{{"Cancel order" | translate}}</button>

                    <a class="btn" button ion-button icon-start href="tel:{{provider.contact}}" *ngIf="order.status == 'Scheduled' && order.quotation_approved == 'Y'"><ion-icon name="call"></ion-icon> {{"Call" | translate}}</a>

                    <button *ngIf="order.status == 'Complete' && unpaid" (click)="openSelect()" ion-button block class="btn">{{"Make Payment" | translate}}</button>

                    <a *ngIf="order.status != 'Complete'" class="btn" button ion-button icon-start href="tel:+91 864 209 3333"><ion-icon name="call"></ion-icon> {{"Helpline" | translate}}</a>

                    <img *ngIf="!unpaid && order.status == 'Complete'" style="max-height: 100px; margin: auto" src="../assets/imgs/paid.png" />
                </div>
            </ion-col>

            <!-- payment options -->
            <ion-item hidden>
                <ion-label>{{"Payment Mode" | translate}}</ion-label>
                <ion-select id="paymentMode" (ionChange)="pay()" [(ngModel)]="paymentMode">
                     <ion-option value="Online">{{"Online"  | translate}}</ion-option>
                     <ion-option value="Cash">{{"Cash" | translate}}</ion-option>
                </ion-select>
            </ion-item>    
            <!-- payment options -->
            <ion-item hidden>
                <ion-label>{{"What are you paying for?" | translate}}</ion-label>
                <ion-select id="paymentMode" (ionChange)="processPayment()" [(ngModel)]="paymentType">
                     <ion-option value="service_charge" selected>{{"Service Charge" | translate}} - {{order.quotation | currency: "₹"}}</ion-option>
                     <ion-option value="visiting_charge" selected>{{"Visiting Charge" | translate}} - {{subcat.visiting_charge | currency: "₹"}}</ion-option>
                </ion-select>
            </ion-item>    

        </ion-row>
    </div>

    <div class="appointment_details">
        <ion-list no-lines>
            <ion-item>
                <div class="img_box center_img" item-start>
                    <img src="{{provider.upload_photo}}" class="invisible crop_img" (load)="onImageLoad($event.target)">
                </div>
                <h2 class="d-flex">{{provider.name}}</h2>
                <div class="text-box">
                    <h3>{{'Job Task' | translate}}</h3>
                    <h4>{{subcat.name}}</h4>
                </div>
                <ion-row>
                    <ion-col col-6>
                        <div class="text-box">
                            <h3>{{'Job Date' | translate}}</h3>
                            <h4>{{order.created_at | date:'MMM d, y, h:mm a'}}</h4>
                        </div>
                    </ion-col>
                    <ion-col col-6 *ngIf="['Quoted','Scheduled','Complete'].indexOf(order.status) != -1">
                        <div class="text-box">
                            <h3>{{'Job Cost' | translate}}</h3>
                            <h4><b>{{'₹'+order.quotation}}</b></h4>
                        </div>
                    </ion-col>
                </ion-row>
                <div class="text-box" *ngIf="order.quotation_note">
                    <h3>{{"Quotation Note" | translate}}</h3>
                    <h4>{{order.quotation_note}}</h4>
                </div>
                <div class="text-box">
                    <h3>{{"Job Details" | translate}}</h3>
                    <h4>{{order.requirement}}</h4>
                </div>
                <div *ngIf="order.status == 'Rejected'" class="text-box">
                    <h3>{{"Reason for rejection" | translate}}</h3>
                    <h4>{{order.reject_reason}}</h4>
                </div>
                <div class="text-box" *ngIf="(order.status == 'Accepted' || order.status == 'Scheduled') && order.quotation_approved == 'Y'">
                    <h3>{{"Address" | translate}}</h3>
                    <h4>{{order.service_address}}</h4>
                </div>
                <!-- <div class="text-box" *ngIf="(order.status == 'Accepted' || order.status == 'Scheduled') && order.quotation_approved == 'Y'">
                    <h3>Contact Number</h3>
                    <h4><a href="tel:{{customer.contact}}">{{customer.contact}}</a></h4>
                </div> -->
                <div class="text-box" *ngIf="(order.status == 'Scheduled')">
                    <h3>{{"Service Schedule" | translate}}</h3>
                    <h4>{{order.service_schedule | date : "MMM d, y, h:mm a"}}</h4>
                </div>
            </ion-item>
        </ion-list>

        <ion-grid *ngIf="order.image != 'null'">
          <ion-row>
            <ion-col col-4 *ngFor="let img of orderImages;let indexOfelement=index;">
                <div class="imgBg">    
                    <img src="{{baseurl+img}}" class="invisible" (load)="onImageLoad($event.target)" (click)="openPopup(indexOfelement)" />
                </div>    
            </ion-col>
          </ion-row>
        </ion-grid>

        <div style="margin: 20px 10px 0 10px" *ngIf="order.status == 'Complete'">
            <button (click)="takeOrderNote()" block ion-button class="button-wp-danger" icon-start><ion-icon name="alert"></ion-icon> {{"Leave Comment" | translate}}</button>
        </div>

        <br/><br/>

    </div>
</ion-content>
